<div class="lugares-page">
  <header class="page-header">
    <div>
      <h1>
        <span class="material-icons">place</span>
        Lugares
      </h1>
      <p>Gestiona los lugares para eventos</p>
    </div>
    <button class="btn-primary" (click)="openModal()">
      <span class="material-icons">add</span>
      Nuevo Lugar
    </button>
  </header>

  <div class="filters-card">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (ngModelChange)="loadLugares()"
      placeholder="Buscar lugares..."
      class="search-input"
    />
  </div>

  <div class="content-card">
    <div *ngIf="loading" class="loading-state">Cargando lugares...</div>
    
    <div *ngIf="!loading && lugares.length > 0" class="grid-cards">
      <div *ngFor="let lugar of lugares" class="lugar-card">
        <div class="lugar-header">
          <span class="material-icons">place</span>
          <div class="lugar-actions">
            <button class="btn-icon" (click)="openModal(lugar)">
              <span class="material-icons">edit</span>
            </button>
            <button class="btn-icon" (click)="toggleActivo(lugar)">
              <span class="material-icons">{{ lugar.activo ? 'block' : 'check_circle' }}</span>
            </button>
          </div>
        </div>
        <h3>{{ lugar.nombre }}</h3>
        <p class="lugar-direccion">{{ lugar.direccion }}</p>
        <p class="lugar-ciudad">{{ lugar.ciudad }}, {{ lugar.pais }}</p>
        <div *ngIf="lugar.capacidad_maxima" class="lugar-capacidad">
          <span class="material-icons">people</span>
          Capacidad: {{ lugar.capacidad_maxima }}
        </div>
        <div class="lugar-footer">
          <span [class]="lugar.activo ? 'badge-success' : 'badge-danger'">
            {{ lugar.activo ? 'Activo' : 'Inactivo' }}
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="!loading && lugares.length === 0" class="empty-state">
      <div class="empty-icon-wrapper">
        <span class="material-icons empty-icon">place</span>
      </div>
      <h3 class="empty-title">No se encontraron lugares</h3>
      <p class="empty-subtitle">Crea tu primer lugar para organizar tus eventos.</p>
      <button class="btn-view-all" (click)="openModal()">Crear Lugar</button>
    </div>

    <div *ngIf="total > limit" class="pagination">
      <button (click)="page = page - 1; loadLugares()" [disabled]="page === 1">Anterior</button>
      <span>Página {{ page }} de {{ Math.ceil(total / limit) }}</span>
      <button (click)="page = page + 1; loadLugares()" [disabled]="page >= Math.ceil(total / limit)">Siguiente</button>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingLugar ? 'Editar Lugar' : 'Nuevo Lugar' }}</h2>
        <button class="btn-close" (click)="closeModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" [(ngModel)]="formData.nombre" required />
        </div>
        <div class="form-group">
          <label>Dirección *</label>
          <input type="text" [(ngModel)]="formData.direccion" required />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Ciudad *</label>
            <input type="text" [(ngModel)]="formData.ciudad" required />
          </div>
          <div class="form-group">
            <label>País</label>
            <input type="text" [(ngModel)]="formData.pais" />
          </div>
        </div>
        <div class="form-group">
          <label>Capacidad Máxima</label>
          <input type="number" [(ngModel)]="formData.capacidad_maxima" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Latitud</label>
            <input 
              type="number" 
              step="0.00000001" 
              min="-90" 
              max="90"
              [(ngModel)]="formData.latitud" 
              placeholder="-90 a 90"
            />
            <small style="color: #666; font-size: 0.85em;">Rango: -90 a 90</small>
          </div>
          <div class="form-group">
            <label>Longitud</label>
            <input 
              type="number" 
              step="0.00000001" 
              min="-180" 
              max="180"
              [(ngModel)]="formData.longitud" 
              placeholder="-180 a 180"
            />
            <small style="color: #666; font-size: 0.85em;">Rango: -180 a 180</small>
          </div>
        </div>
        <div class="form-group">
          <label>Teléfono</label>
          <input type="tel" [(ngModel)]="formData.telefono" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="formData.email" />
        </div>
        <div class="form-group">
          <label>Sitio Web</label>
          <input type="url" [(ngModel)]="formData.sitio_web" />
        </div>
        <div class="form-group">
          <label>Descripción</label>
          <textarea [(ngModel)]="formData.descripcion" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Imagen Principal</label>
          <button type="button" class="btn-secondary" (click)="selectImage()" [disabled]="uploadingImage">
            <span class="material-icons">image</span>
            {{ uploadingImage ? 'Subiendo...' : 'Seleccionar Imagen' }}
          </button>
          <input 
            type="file" 
            id="lugarImageInput" 
            accept="image/*" 
            (change)="onFileSelected($event)"
            style="display: none;">
          
          <!-- Preview de imagen -->
          <div *ngIf="previewUrl" class="image-preview-container">
            <img [src]="previewUrl" alt="Preview" class="image-preview" />
            <button type="button" class="btn-remove-image" (click)="removeImage()" title="Eliminar imagen">
              <span class="material-icons">close</span>
            </button>
          </div>
          
          <!-- Mostrar URL actual si existe y no hay preview -->
          <div *ngIf="formData.imagen_principal && !previewUrl && !selectedFile" class="current-image-info">
            <small>Imagen actual: <a [href]="formData.imagen_principal" target="_blank">Ver imagen</a></small>
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="formData.activo" />
            Activo
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancelar</button>
        <button class="btn-primary" (click)="saveLugar()">Guardar</button>
      </div>
    </div>
  </div>
</div>
